# VHS tape for testing wikilink diagnostics and code actions
# Tests ambiguous wikilink warnings and resolution

Output "{{.OutputFile}}"
Output "{{.TmpDir}}/wikilink-diagnostics.gif"
Set FontSize 14
Set Width 120
Set Height 120
Set TypingSpeed 50ms

# Hide the shell navigation and setup
Hide

# Change to diagnostics test workspace
Type "cd {{.WorkspaceDir}}"
Enter
Sleep 500ms

# Start Neovim with VHS test configuration
Type "nvim --noplugin -u '{{.ConfigFile}}' main.md"
Enter
Sleep 4s

# Show recording once Neovim is loaded
Show

# Show diagnostics to verify ambiguous wikilink is detected
Type ":lua vim.diagnostic.open_float()"
Enter
Sleep 2s

# Close the diagnostic float
Escape

# Navigate to the ambiguous wikilink
Type "gg"
Type "/\\[\\[config\\]\\]"
Enter
Sleep 1s

# Position cursor on config text
Type "f]"
Type "h"

# Show available code actions
Type ":lua vim.lsp.buf.code_action()"
Enter
Sleep 2s

# Try to select first code action (resolve to root config)
Type "1"
Enter
Sleep 1s

# Show the result by displaying the line
Type ":echo 'Code action applied'"
Enter  
Sleep 1s

# Check diagnostics again to see if they're resolved
Type ":lua print('Diagnostics check: ' .. #vim.diagnostic.get(0))"
Enter
Sleep 1s

# Hide before exiting
Hide

# Exit Neovim
Type ":qa!"
Enter
Sleep 500ms

# Return to root directory  
Type "cd {{.TmpDir}}"
Enter