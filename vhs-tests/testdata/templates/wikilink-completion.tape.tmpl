# VHS tape for testing wikilink completion functionality
# Tests autocompletion for wikilinks

Output "{{.OutputFile}}"
Output "{{.TmpDir}}/wikilink-completion.gif"
Set FontSize 14
Set Width 120
Set Height 120
Set TypingSpeed 50ms

# Hide the shell navigation and setup
Hide

# Change to completion test workspace
Type "cd {{.WorkspaceDir}}"
Enter
Sleep 500ms

# Start Neovim with VHS test configuration
Type "nvim --noplugin -u '{{.ConfigFile}}' index.md"
Enter
Sleep 3s

# Show recording once Neovim is loaded
Show

# Move to end of file and enter insert mode
Type "G"
Type "o"
Type "o"

# Start typing a wikilink to trigger completion
Type "Link to [["
Sleep 1s

# Trigger completion manually
Ctrl+X
Ctrl+O
Sleep 2s

# Show the completion menu (if available)
Type "docs/"
Sleep 1s

# Complete with first suggestion or continue typing
Ctrl+X
Ctrl+O
Sleep 2s

# Exit insert mode
Escape
Sleep 1s

# Add another line to test different completion
Type "o"
Type "Another link: [[notes/"
Sleep 1s

# Trigger completion for notes directory
Ctrl+X
Ctrl+O
Sleep 2s

# Exit insert mode
Escape

# Save and show the result
Type ":w"
Enter
Sleep 1s

# Show file contents to verify completion worked
Type ":echo 'Completion test completed'"
Enter
Sleep 1s

# Hide before exiting
Hide

# Exit Neovim
Type ":qa"
Enter
Sleep 500ms

# Return to root directory
Type "cd {{.TmpDir}}"
Enter